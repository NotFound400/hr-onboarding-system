## 前端页面与接口调用映射

| 页面名称/功能 | 前端路由 | 涉及的 API Endpoints | 业务逻辑/依赖备注 |
| --- | --- | --- | --- |
| MainLayout（受保护区共享布局） | /employee/*、/hr/* | 1. GET /employees/user/{userId} (串行，仅 Employee 角色；用 token 中的 userId) | 用当前员工的 active Visa 判断是否展示“Visa Status”菜单；加载一次后供所有子页共用 |
| Login 登录页 | /login | 1. POST /auth/login (提交凭证)<br>2. GET /employees/user/{userId} (串行，仅 Employee，拿 Mongo employeeId)<br>3. GET /applications/employee/{employeeId} (串行，基于 employeeId 判断 Onboarding 状态) | 登录成功后根据角色跳转；Employee 必须串行拿 employeeId→申请列表来决定重定向到 /onboarding 或 /employee/personal-info |
| Registration 注册页 | /register?token=xxx | 1. GET /auth/validate-token/{token} (串行，页面加载必走)<br>2. POST /auth/register (串行，token 验证通过后提交密码/用户名) | 注册过程完全依赖 URL token，若校验失败阻止表单；成功后回到 /login |
| Onboarding Form | /onboarding/form | 1. POST /employees (submitOnboardingForm → createEmployee，串行提交整套表单) | 没有预取接口；表单通过 Redux thunk 将 CreateEmployeeRequest 发给后端，成功后跳转到 /onboarding/docs |
| Onboarding Docs | /onboarding/docs | 无真实 API 调用（DocumentUpload 组件内部是本地 Mock 上传） | 仅做必填校验，所有“上传”操作发生在前端模拟层；提交按钮只做 `setTimeout` 模拟 |
| Onboarding Submit Result | /onboarding/submit-result | 1. POST /auth/logout (点击“Back to Login”时串行调用) | 退出后清空本地认证并重定向登录页；未额外读取数据 |
| Onboarding Rejected | /onboarding/rejected | 1. GET /employees/user/{userId} (串行，拿 employeeId)<br>2. GET /applications/employee/{employeeId} (串行，根据 employeeId 过滤出 status=Rejected 且 type=Onboarding) | 若未找到被拒申请则提示“无记录”；找到后展示 HR comment、缺失文档等 |
| Employee Home | /employee/home | 1. GET /employees/user/{userId} (串行)<br>2. GET /employees/{employeeId} (串行，依赖上一条得到的 MongoId) | 用完整 Employee Profile 渲染欢迎区域及个人摘要 |
| Personal Info | /employee/personal-info | 1. GET /employees/user/{userId} → 2. GET /employees/{employeeId} (串行加载资料)<br>3. PUT /employees/{employeeId} (按区块保存；每次保存后再串行触发 1→2 以刷新) | 每个板块单独调用 updateEmployee；需要 employeeId（来自第 1 步）才能提交 |
| Visa Status | /employee/visa | 1. GET /employees/user/{userId} → 2. GET /employees/{employeeId} (串行加载签证/公民信息) | 仅基于现有 profile 渲染；DocumentUpload 仍是前端 mock，不会打接口 |
| Housing（员工房屋概览） | /employee/housing | 1. GET /housing/houses/{houseId} (串行，若 auth state 已缓存 houseId，尝试 HR 视角 detail)<br>2. GET /housing/houses/my-house (串行兜底，若步骤1返回非 Employee 视角或 houseId 不存在) | 成功后展示 roommates、房屋详情；失败时提示“未分配房屋” |
| House Detail（员工视角） | /employee/house-detail | 1. GET /employees/user/{userId} (串行，读取 employee.houseID)<br>2. GET /housing/houses/{houseID} (串行，限定返回 EMPLOYEE_VIEW) | 若员工尚未被分配 houseId 则提示 No Housing Assigned |
| Facility Report | /employee/facility-report | 1. GET /housing/facility-reports/my-reports (串行，加载本人工单列表)<br>2. GET /housing/facilities/house/{houseId} (串行，基于 auth.houseId 获取设施选项)<br>3. POST /housing/facility-reports (串行，新建工单；成功后再次触发第1步刷新)<br>4. GET /housing/facility-reports/{reportId} (查看/刷新详情)<br>5. POST /housing/facility-reports/comments (串行，新增评论后刷新 #4/#1)<br>6. PUT /housing/facility-reports/comments/{commentId} (串行，编辑评论后刷新 #4) | 依赖 auth 中的 houseId；所有评论、查看详情均基于 reportId 串行调用，提交/编辑完成后会重新抓取列表确保状态一致 |
| HR Home Dashboard | /hr/home | 1. GET /applications/ongoing (加载所有待处理申请) | 前端再过滤 status=Pending/Open，表格用于提醒需要 HR action 的 Onboarding/OPT |
| Employee Profiles 列表 | /hr/employees | 1. GET /employees (加载全部员工供搜索/排序) | 搜索仅在前端进行；点击行跳转详情 |
| Employee Profile Detail | /hr/employees/:id | 1. GET /employees (串行，按 userID 排序用于 <current/total> 导航)<br>2. GET /employees/{id} (串行，加载该员工完整档案)<br>3. GET /applications/employee/{employeeId} (串行，抓取该员工 active Onboarding/OPT 申请及文档) | 详情页的 `<10/100>` 导航需要完整列表；文档评论目前只在前端保存并未回写后端 |
| Visa Management (HR) | /hr/visa | 1. GET /applications/ongoing (串行，过滤出 applicationType=OPT)<br>2. POST /applications/{applicationId}/approve (按行操作)<br>3. POST /applications/{applicationId}/reject (按行操作，先填写 Modal comment) | Approve/Reject 后都会重新请求列表以刷新状态，并提示“已发送邮件” |
| Hiring & Token 管理 | /hr/hiring | 1. GET /applications/ongoing (串行，筛选 Onboarding 申请列表)<br>2. GET /housing/houses/summaries (串行，只保留 availableSpots>0)<br>3. GET /housing/houses/{houseId}/availability (串行，生成 token 前校验容量)<br>4. POST /auth/registration-token (串行，创建注册验证码并回填有效期)<br>5. GET /housing/houses/summaries (串行，生成成功后刷新可用房屋) | Token 生成前必须确认房屋仍有空位；成功后也会重置表单并提醒 HR |
| Application Review Detail (HR) | /hr/applications/:id | 1. GET /applications/{id} (串行，获取申请及 employeeId)<br>2. GET /employees/{employeeId} (串行，展示完整表单信息)<br>3. POST /applications/{id}/approve (Approval 流程)<br>4. POST /applications/{id}/reject (Reject 时要求 comment) | Approve/Reject 成功后跳回 /hr/hiring；文档评论 UI 目前仅本地状态 |
| House Management (HR) | /hr/housing | 1. GET /housing/houses (串行，房屋列表)<br>2. POST /housing/houses (串行，新增房屋，成功后重拉 #1)<br>3. DELETE /housing/houses/{id} (串行，删除房屋，成功后重拉 #1) | “View Details” 会跳转到 /hr/houses/:id；新增表单中 landlord 信息统一打到 HR 视角接口 |
| House Detail Management (HR) | /hr/houses/:id | 1. GET /housing/houses/{id} (串行，必须返回 HR_VIEW)<br>2. GET /housing/facility-reports (串行，拿报修 ID 列表)<br>3. GET /housing/facility-reports/{reportId} (并行，Promise.all 逐条获取详情；Modal 打开/刷新时也会单独调用)<br>4. GET /employees (串行，前端过滤 houseID=当前房屋 的住户列表)<br>5. POST /housing/facility-reports/comments (串行，Modal 新增评论后刷新 #3)<br>6. PUT /housing/facility-reports/comments/{commentId} (串行，编辑评论后刷新 #3) | 需要组合房屋详情+报修详情+住户列表；Facility Report Modal 依赖 currentUser.id 判断评论可编辑性 |
